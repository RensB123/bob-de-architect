<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8" />
    <title>Modulo Spel - Tik het Juiste Antwoord!</title>
    <style>
        html, body {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden; /* Voorkom scrollbars */
            font-family: Arial, sans-serif;
            background: #f0f8ff;
        }

        /* Titel/score bovenin */
        #header {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            background: #fff;
            border-bottom: 2px solid #ccc;
            padding: 10px;
            box-sizing: border-box;
            z-index: 10000; /* Zorg dat dit altijd boven de bubbels ligt */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #question {
            font-size: 1.5rem;
            font-weight: bold;
        }

        #scoreboard {
            font-size: 1.2rem;
        }

        /* Container voor alle antwoord-bubbels */
        #bubbleContainer {
            position: absolute;
            top: 60px; /* Onder de header */
            left: 0;
            width: 100%;
            height: calc(100% - 60px);
        }

        /* Standaard styling voor bubbels */
        .bubble {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: rgba(0, 180, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            user-select: none;     /* Geen tekstselectie */
            touch-action: none;    /* Beter voor mobiel */
            transition: background-color 0.2s;
        }
        .bubble:hover {
            background-color: rgba(0, 180, 255, 1);
        }

        /* Canvas voor vuurwerk */
        #fireworksCanvas {
            pointer-events: none;      /* Kliks gaan door naar achterliggende elementen */
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
        }
    </style>
</head>
<body>

<!-- Bovenbalk met som en score -->
<div id="header">
    <div id="question">0 mod 0 = ?</div>
    <div id="scoreboard">Goed: <span id="correctCount">0</span></div>
</div>

<!-- Container voor de bubbels (antwoorden) -->
<div id="bubbleContainer"></div>

<!-- Canvas voor het vuurwerk -->
<canvas id="fireworksCanvas"></canvas>

<script>
    // =====================================
    //           SPEL VARIABELEN
    // =====================================

    const questionEl = document.getElementById('question');
    const correctCountEl = document.getElementById('correctCount');
    const bubbleContainer = document.getElementById('bubbleContainer');

    // Houdt bij hoeveel vragen goed zijn beantwoord
    let correctAnswers = 0;
    // Hoeveel antwoorden tonen we? (1 juiste + (n-1) foute)
    const NUMBER_OF_ANSWERS = 4;

    // Afhankelijk of we in 'vuurwerkfase' zijn
    let inFireworkPhase = false;

    // Fireworks
    const canvas = document.getElementById('fireworksCanvas');
    const ctx = canvas.getContext('2d');
    let fireworks = [];
    let fireworksInterval = null;
    let fireworksAnimationFrame = null;

    // =====================================
    //        HELPER FUNCTIES
    // =====================================

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Willekeurige integer tussen min en max (inclusief max)
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    /**
     * Genereer een willekeurige modulo-som en retourneer een object:
     * {
     *   a: number,
     *   b: number,
     *   correct: (a % b),
     *   answers: [correct, ...fouteAntwoorden]
     * }
     */
    function generateModuloQuestion() {
        // Kies a en b in het bereik 1..300 (en b niet 0)
        let a = getRandomInt(1, 300);
        let b = getRandomInt(1, 300);

        // Bereken het juiste antwoord
        const correct = a % b;

        // We genereren NUMBER_OF_ANSWERS-1 willekeurige foute antwoorden
        const answers = [correct];
        while (answers.length < NUMBER_OF_ANSWERS) {
            let wrong = getRandomInt(0, 300);
            // Zorg dat we geen duplicaat hebben
            if (!answers.includes(wrong)) {
                answers.push(wrong);
            }
        }

        // We husselen de volgorde van de antwoorden zodat de juiste niet altijd op index 0 staat
        answers.sort(() => Math.random() - 0.5);

        return {
            a,
            b,
            correct,
            answers,
        };
    }

    /**
     * Hulpfunctie om een willekeurig geheel getal in [min, max] te krijgen.
     */
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }


    // =====================================
    //      BUBBELS MAKEN EN VERPLAATSEN
    // =====================================

    let bubbleElements = [];  // Bewaar referenties van de actuele bubbels
    let bubbleMoveInterval = null;

    /**
     * Plaats alle bubbels op willekeurige posities binnen bubbleContainer
     */
    function positionBubbles() {
        // Breedte en hoogte van de container
        const containerWidth = bubbleContainer.clientWidth;
        const containerHeight = bubbleContainer.clientHeight;

        bubbleElements.forEach(bubble => {
            // Elk bubbel-element is 80x80px (zie CSS)
            const maxLeft = containerWidth - 80;
            const maxTop = containerHeight - 80;
            const left = getRandomInt(0, maxLeft);
            const top = getRandomInt(0, maxTop);

            bubble.style.left = `${left}px`;
            bubble.style.top = `${top}px`;
        });
    }

    /**
     * Verwijder alle bubbels uit de container
     */
    function clearBubbles() {
        bubbleElements.forEach(bubble => bubble.remove());
        bubbleElements = [];
    }

    // =====================================
    //           VRAAG STARTEN
    // =====================================

    function showNewQuestion() {
        inFireworkPhase = false;

        // Genereer nieuwe modulo-som
        const { a, b, correct, answers } = generateModuloQuestion();
        questionEl.textContent = `${a} mod ${b} = ?`;

        // Oude bubbels opruimen
        clearBubbles();

        // Maak voor elk antwoord een bubbel
        answers.forEach(answer => {
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.textContent = answer;

            // Als je op een bubbel klikt/tikt
            bubble.addEventListener('click', () => {
                if (inFireworkPhase) return; // Geen dubbele kliks bij vuurwerk
                if (answer === correct) {
                    // Juiste antwoord
                    correctAnswers++;
                    correctCountEl.textContent = correctAnswers;
                    startFireworks();
                } else {
                    // Fout, evt. feedback
                    bubble.style.backgroundColor = 'rgba(255, 0, 0, 0.8)';
                }
            });

            bubbleContainer.appendChild(bubble);
            bubbleElements.push(bubble);
        });

        // Start (her)positionering van bubbels elke 2 seconden
        positionBubbles();
        if (bubbleMoveInterval) clearInterval(bubbleMoveInterval);
        bubbleMoveInterval = setInterval(positionBubbles, 1500);
    }

    // =====================================
    //           VUURWERK LOGICA
    // =====================================

    class FireworkParticle {
        constructor(x, y, angle, speed, color) {
            this.x = x;
            this.y = y;
            this.angle = angle;
            this.speed = speed;
            this.color = color;
            this.alpha = 1;
            this.decay = 0.01 + Math.random() * 0.02;
            this.radius = 2 + Math.random() * 3;
        }

        update() {
            this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed;
            this.speed *= 0.97;
            this.alpha -= this.decay;
        }

        draw(ctx) {
            ctx.save();
            ctx.globalAlpha = this.alpha;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
            ctx.fillStyle = this.color;
            ctx.fill();
            ctx.restore();
        }
    }

    // CreÃ«er veel deeltjes (explosie) op x,y
    function createFireworkBurst(x, y) {
        const numParticles = 100 + Math.floor(Math.random() * 50);
        const colors = [
            '#ff0040', '#ff8c00', '#ffff00',
            '#00ff00', '#00bfff', '#9932cc',
            '#ff69b4', '#00ffff', '#f0e68c'
        ];
        for (let i = 0; i < numParticles; i++) {
            const angle = Math.random() * 2 * Math.PI;
            const speed = 2 + Math.random() * 7;
            const color = colors[Math.floor(Math.random() * colors.length)];
            fireworks.push(new FireworkParticle(x, y, angle, speed, color));
        }
    }

    function animateFireworks() {
        fireworksAnimationFrame = requestAnimationFrame(animateFireworks);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        fireworks.forEach((p) => {
            p.update();
            p.draw(ctx);
        });
        fireworks = fireworks.filter(p => p.alpha > 0);
    }

    function startFireworks() {
        inFireworkPhase = true;

        // Stop de bubbels (geen herpositionering meer)
        clearInterval(bubbleMoveInterval);

        // In deze periode mag je niet opnieuw klikken
        fireworks = [];
        cancelAnimationFrame(fireworksAnimationFrame);
        animateFireworks();

        // Elke 300 ms een nieuwe explosie
        fireworksInterval = setInterval(() => {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height * 0.6;
            createFireworkBurst(x, y);
        }, 300);

        // Na 5 seconden stoppen we met vuurwerk en tonen we de volgende som
        setTimeout(() => {
            clearInterval(fireworksInterval);
            // Even laten uitfaden...
            setTimeout(() => {
                cancelAnimationFrame(fireworksAnimationFrame);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                showNewQuestion();
            }, 2000);
        }, 5000);
    }

    // =====================================
    //   START: Toon direct eerste vraag
    // =====================================
    showNewQuestion();
</script>
</body>
</html>
